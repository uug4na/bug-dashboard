services:
  app:
    build: ./app
    container_name: bugdash-app
    ports: ["8081:8080"]
    environment:
      AUTH_USERNAME: "admin"
      AUTH_PASSWORD: "change-me"
      DB_PATH: "/data/bugdash.db"
      NUCLEI_TEMPLATES_DIR: "/data/nuclei-templates"
      CUSTOM_TEMPLATES_DIR: "/data/custom-templates"
    volumes:
      - ./data:/data
      - ./logs:/var/log/bugdash
    depends_on: [worker, scheduler]

  worker:
    build: ./worker
    container_name: bugdash-worker
    environment:
      DB_PATH: "/data/bugdash.db"
      NUCLEI_TEMPLATES_DIR: "/data/nuclei-templates"
      CUSTOM_TEMPLATES_DIR: "/data/custom-templates"
      WORKER_CONCURRENCY: "3"        # <— run up to 3 scans in parallel
      WORKER_POLL_SEC: "2"           # <— check the queue every 2s
    volumes:
      - ./data:/data
      - ./logs:/var/log/bugdash

  scheduler:
    build: ./scheduler
    container_name: bugdash-scheduler
    environment:
      DB_PATH: "/data/bugdash.db"
      MERGE_WILDCARDS_INTERVAL_SEC: "1800"
      ENQUEUE_INTERVAL_SEC: "30"       # <— try to enqueue often
      SCAN_COOLDOWN_SEC: "86400"
      MAX_PARALLEL_QUEUED: "100"       # <— with worker pulling, this can be big
      ARKADIYT_WILDCARDS_URL: "https://raw.githubusercontent.com/arkadiyt/bounty-targets-data/main/data/wildcards.txt"
    volumes:
      - ./data:/data
      - ./logs:/var/log/bugdash
    depends_on: [worker]
